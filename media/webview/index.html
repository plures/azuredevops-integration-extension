<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Azure DevOps Work Items</title>
    <style>
      :root {
        --vscode-font-family: var(--vscode-font-family, 'Segoe UI', sans-serif);
        --vscode-editor-background: var(--vscode-editor-background, #1e1e1e);
        --vscode-editor-foreground: var(--vscode-editor-foreground, #d4d4d4);
        --vscode-button-background: var(--vscode-button-background, #0e639c);
        --vscode-button-foreground: var(--vscode-button-foreground, #ffffff);
        --vscode-button-hoverBackground: var(--vscode-button-hoverBackground, #1177bb);
        --vscode-editorWidget-border: var(--vscode-editorWidget-border, #454545);
        --vscode-list-hoverBackground: var(--vscode-list-hoverBackground, #2a2d2e);
        --vscode-badge-background: var(--vscode-badge-background, #4d4d4d);
        --vscode-badge-foreground: var(--vscode-badge-foreground, #ffffff);

        /* ADO-inspired accent colors (small stripes/dots only; backgrounds still respect theme) */
        --ado-state-new: #b2b2b2;
        --ado-state-todo: #b2b2b2;
        --ado-state-active: #007acc;
        --ado-state-inprogress: #e69700;
        --ado-state-doing: #e69700;
        --ado-state-review: #6b4eff;
        --ado-state-testing: #0098c7;
        --ado-state-resolved: #339933;
        --ado-state-done: #339933;
  --ado-state-closed: #339933;
        --ado-state-removed: #ff6347;

        --ado-type-bug: #d83b01;
        --ado-type-task: #a4880a;
        --ado-type-story: #0098c7;
        --ado-type-feature: #7fba00;
        --ado-type-epic: #744da9;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: var(--vscode-font-family);
        background: var(--vscode-editor-background);
        color: var(--vscode-editor-foreground);
        line-height: 1.4;
      }

      .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.75rem 1rem;
        border-bottom: 1px solid var(--vscode-editorWidget-border);
        background: var(--vscode-editorGroupHeader-tabsBackground);
      }

      .app-title {
        margin: 0;
        font-size: 1.1em;
        font-weight: 600;
      }

      .header-actions {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .search-container {
        padding: 8px 16px;
        border-bottom: 1px solid var(--vscode-editorWidget-border);
        background: var(--vscode-editor-background);
      }

      .search-input {
        width: 100%;
        padding: 6px 12px;
        border: 1px solid var(--vscode-editorWidget-border);
        border-radius: 4px;
        background: var(--vscode-input-background);
        color: var(--vscode-input-foreground);
        font-size: 13px;
      }

      .search-input:focus {
        outline: none;
        border-color: var(--vscode-focusBorder);
      }

      .status-overview {
        display: flex;
        gap: 8px;
        padding: 8px 16px;
        border-bottom: 1px solid var(--vscode-editorWidget-border);
        background: var(--vscode-editorGroupHeader-tabsBackground);
        flex-wrap: wrap;
      }

      .status-badge {
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 4px 8px;
        background: var(--vscode-badge-background);
        color: var(--vscode-badge-foreground);
        border-radius: 12px;
        font-size: 11px;
        cursor: pointer;
        transition: opacity 0.2s ease;
      }

      .status-badge:hover {
        opacity: 0.8;
      }

      .status-name {
        font-weight: 500;
      }

      .status-count {
        background: rgba(255, 255, 255, 0.2);
        padding: 1px 4px;
        border-radius: 8px;
        font-weight: 600;
      }

      .filters-container {
        display: flex;
        gap: 8px;
        padding: 8px 16px;
        border-bottom: 1px solid var(--vscode-editorWidget-border);
        background: var(--vscode-editor-background);
      }

      .filter-dropdown {
        padding: 4px 8px;
        border: 1px solid var(--vscode-editorWidget-border);
        border-radius: 4px;
        background: var(--vscode-dropdown-background);
        color: var(--vscode-dropdown-foreground);
        font-size: 12px;
        min-width: 120px;
      }

      .filter-dropdown:focus {
        outline: none;
        border-color: var(--vscode-focusBorder);
      }

      .btn {
        background: var(--vscode-button-background);
        color: var(--vscode-button-foreground);
        border: none;
        padding: 0.4rem 0.8rem;
        cursor: pointer;
        border-radius: 2px;
        font-size: 0.9em;
      }

      .btn:hover {
        background: var(--vscode-button-hoverBackground);
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .main {
        display: flex;
        gap: 1rem;
        padding: 1rem;
        height: calc(100vh - 60px);
      }

      .column {
        flex: 1;
        min-width: 0;
      }

      .column.narrow {
        max-width: 280px;
      }

      /* Full width when timer is hidden */
      .main:not(:has(#timerColumn:not([style*='display: none']))) #workItemsColumn {
        width: 100%;
      }

      /* Timer column animations */
      #timerColumn {
        transition: all 0.3s ease;
      }

      #timerColumn.timer-visible {
        display: flex !important;
        animation: slideIn 0.3s ease;
      }

      #timerColumn.timer-hidden {
        animation: slideOut 0.3s ease;
      }

      @keyframes slideIn {
        from {
          max-width: 0;
          opacity: 0;
        }
        to {
          max-width: 280px;
          opacity: 1;
        }
      }

      @keyframes slideOut {
        from {
          max-width: 280px;
          opacity: 1;
        }
        to {
          max-width: 0;
          opacity: 0;
        }
      }

      .section {
        margin-bottom: 1.5rem;
      }

      .section-title {
        font-size: 1em;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--vscode-editor-foreground);
      }

      .work-items {
        max-height: calc(100vh - 120px);
        overflow-y: auto;
      }

      .work-item {
        padding: 0.75rem;
        border: 1px solid var(--vscode-editorWidget-border);
        margin-bottom: 0.5rem;
        border-radius: 3px;
        cursor: pointer;
        transition: background-color 0.1s;
      }

      .work-item:hover {
        background: var(--vscode-list-hoverBackground);
      }

      .work-item-title {
        font-weight: 500;
        margin-bottom: 0.25rem;
      }

      .work-item-meta {
        font-size: 0.85em;
        opacity: 0.8;
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
      }

      .work-item-id {
        background: var(--vscode-badge-background);
        color: var(--vscode-badge-foreground);
        padding: 0.1rem 0.4rem;
        border-radius: 10px;
        font-size: 0.75em;
        font-weight: 500;
      }

      /* Rich Work Item Card Styles */
      .work-item-card {
        display: flex;
        flex-direction: column;
        padding: 10px;
        border: 1px solid var(--vscode-editorWidget-border);
        margin-bottom: 8px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s ease;
        background: var(--vscode-editor-background);
        position: relative;
      }

      /* ADO-like left accent stripe by state */
      .work-item-card::before,
      .kanban-card::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 4px;
        border-radius: 6px 0 0 6px;
        background: transparent;
      }
      .work-item-card.state-new::before,
      .kanban-card.state-new::before { background: var(--ado-state-new); }
      .work-item-card.state-todo::before,
      .kanban-card.state-todo::before { background: var(--ado-state-todo); }
      .work-item-card.state-active::before,
      .kanban-card.state-active::before { background: var(--ado-state-active); }
      .work-item-card.state-inprogress::before,
      .kanban-card.state-inprogress::before { background: var(--ado-state-inprogress); }
      .work-item-card.state-doing::before,
      .kanban-card.state-doing::before { background: var(--ado-state-doing); }
      .work-item-card.state-review::before,
      .kanban-card.state-review::before { background: var(--ado-state-review); }
      .work-item-card.state-testing::before,
      .kanban-card.state-testing::before { background: var(--ado-state-testing); }
      .work-item-card.state-resolved::before,
      .kanban-card.state-resolved::before { background: var(--ado-state-resolved); }
      .work-item-card.state-done::before,
      .kanban-card.state-done::before { background: var(--ado-state-done); }
      .work-item-card.state-closed::before,
      .kanban-card.state-closed::before { background: var(--ado-state-closed); }
      .work-item-card.state-removed::before,
      .kanban-card.state-removed::before { background: var(--ado-state-removed); }

      .work-item-card:hover {
        background: var(--vscode-list-hoverBackground);
        border-color: var(--vscode-focusBorder);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .work-item-card.selected {
        border-color: var(--vscode-focusBorder);
        background: var(--vscode-list-activeSelectionBackground);
        color: var(--vscode-list-activeSelectionForeground);
      }
      /* Persist readable contrast when hovering selected cards */
      .work-item-card.selected:hover,
      .kanban-card.selected:hover {
        color: var(--vscode-list-activeSelectionForeground);
      }
      .work-item-card.selected:hover .work-item-title,
      .kanban-card.selected:hover .work-item-title {
        color: var(--vscode-list-activeSelectionForeground) !important;
        text-decoration: underline;
      }
      .work-item-card.selected:hover .work-item-description,
      .kanban-card.selected:hover .work-item-description,
      .work-item-card.selected:hover .work-item-assignee,
      .kanban-card.selected:hover .work-item-assignee,
      .work-item-card.selected:hover .work-item-iteration,
      .kanban-card.selected:hover .work-item-iteration {
        color: var(--vscode-list-activeSelectionForeground);
      }
      /* Ensure text inside selected cards contrasts with selection background */
      .work-item-card.selected .work-item-title,
      .kanban-card.selected .work-item-title {
        color: var(--vscode-list-activeSelectionForeground) !important;
        text-decoration: none;
      }
      .work-item-card.selected .work-item-description,
      .kanban-card.selected .work-item-description,
      .work-item-card.selected .work-item-assignee,
      .kanban-card.selected .work-item-assignee,
      .work-item-card.selected .work-item-iteration,
      .kanban-card.selected .work-item-iteration {
        color: var(--vscode-list-activeSelectionForeground);
      }
      /* Ensure selected cards also neutralize colored icon/priority for readability */
      .work-item-card.selected .work-item-type-icon,
      .kanban-card.selected .work-item-type-icon,
      .work-item-card.selected .work-item-priority,
      .kanban-card.selected .work-item-priority {
        color: var(--vscode-list-activeSelectionForeground) !important;
      }
      /* Kanban selected card uses same foreground for readability */
      .kanban-card.selected {
        color: var(--vscode-list-activeSelectionForeground);
      }

      .work-item-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 6px;
      }

      .work-item-type-icon {
        font-size: 16px;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
        flex-shrink: 0;
        /* ADO-like: colorized icon, no colored background block */
        background: transparent;
      }
      .type-bug { color: var(--ado-type-bug); }
      .type-task { color: var(--ado-type-task); }
      .type-story { color: var(--ado-type-story); }
      .type-feature { color: var(--ado-type-feature); }
      .type-epic { color: var(--ado-type-epic); }

      .work-item-priority {
        margin-left: auto;
        font-size: 12px;
        opacity: 0.9;
      }

      .work-item-content {
        flex: 1;
        margin-bottom: 8px;
      }

      .work-item-card .work-item-title {
        font-weight: 600;
        font-size: 13.5px;
        line-height: 1.3;
        margin-bottom: 6px;
        color: var(--vscode-editor-foreground);
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        line-clamp: 2;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
      }
      /* Ensure any links inside title keep proper color on non-selected hover */
      .work-item-card:not(.selected):hover .work-item-title a,
      .kanban-card:not(.selected):hover .work-item-title a {
        color: var(--vscode-editor-foreground) !important;
      }
      /* For non-selected items, use normal foreground on hover (not link color) */
      .work-item-card:not(.selected):hover .work-item-title,
      .kanban-card:not(.selected):hover .work-item-title {
        color: var(--vscode-editor-foreground) !important;
        text-decoration: underline;
      }
      /* Generic anchors inside non-selected hovered cards should stay neutral */
      .work-item-card:not(.selected):hover a,
      .work-item-card:not(.selected):focus a,
      .kanban-card:not(.selected):hover a,
      .kanban-card:not(.selected):focus a {
        color: var(--vscode-editor-foreground) !important;
      }
      /* Meta rows and badges within non-selected hover keep neutral/description colors */
      .work-item-card:not(.selected):hover .work-item-meta-row,
      .kanban-card:not(.selected):hover .work-item-meta-row,
      .work-item-card:not(.selected):hover .work-item-assignee,
      .kanban-card:not(.selected):hover .work-item-assignee,
      .work-item-card:not(.selected):hover .work-item-iteration,
      .kanban-card:not(.selected):hover .work-item-iteration {
        color: var(--vscode-descriptionForeground) !important;
      }
      /* Non-selected hover should also keep neutral color for type icon and priority */
      .work-item-card:not(.selected):hover .work-item-type-icon,
      .kanban-card:not(.selected):hover .work-item-type-icon,
      .work-item-card:not(.selected):hover .work-item-priority,
      .kanban-card:not(.selected):hover .work-item-priority {
        color: var(--vscode-editor-foreground) !important;
      }

      .work-item-description {
        font-size: 12px;
        color: var(--vscode-descriptionForeground);
        line-height: 1.4;
        margin-bottom: 6px;
        overflow: hidden;
        text-overflow: ellipsis;
  display: -webkit-box;
  line-clamp: 2;
  -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
      }

      .work-item-details {
        display: flex;
        flex-direction: column;
        gap: 3px;
      }

      .work-item-meta-row {
        display: flex;
        gap: 8px;
        align-items: center;
        font-size: 10.5px;
      }

      .work-item-type {
        padding: 2px 6px;
        background: var(--vscode-badge-background);
        color: var(--vscode-badge-foreground);
        border-radius: 10px;
        font-size: 10px;
        font-weight: 500;
      }
      .work-item-card.selected .work-item-type,
      .kanban-card.selected .work-item-type {
        background: rgba(255, 255, 255, 0.2);
        color: var(--vscode-list-activeSelectionForeground);
      }

      .work-item-state {
        padding: 2px 6px;
        border-radius: 10px;
        font-size: 10px;
        font-weight: 600;
        text-transform: uppercase;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }
      .work-item-card.selected .work-item-state,
      .kanban-card.selected .work-item-state {
        /* Keep colored dot but ensure label readable */
        color: var(--vscode-list-activeSelectionForeground);
        background: rgba(255, 255, 255, 0.12);
      }
      /* colored state dot */
      .work-item-state::before {
        content: '';
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: inline-block;
        background: currentColor;
      }

      /* State pill colors (scoped to the pill only to avoid coloring whole cards) */
      .work-item-state.state-new { color: var(--ado-state-new); background: rgba(178, 178, 178, 0.15); }
      .work-item-state.state-todo,
      .work-item-state.state-to-do { color: var(--ado-state-todo); background: rgba(178, 178, 178, 0.15); }
      .work-item-state.state-active { color: var(--ado-state-active); background: rgba(0, 122, 204, 0.10); }
      .work-item-state.state-inprogress,
      .work-item-state.state-in-progress { color: var(--ado-state-inprogress); background: rgba(230, 151, 0, 0.10); }
      .work-item-state.state-doing { color: var(--ado-state-doing); background: rgba(230, 151, 0, 0.10); }
      .work-item-state.state-review,
      .work-item-state.state-code-review { color: var(--ado-state-review); background: rgba(107, 78, 255, 0.12); }
      .work-item-state.state-testing { color: var(--ado-state-testing); background: rgba(0, 152, 199, 0.12); }
      .work-item-state.state-resolved { color: var(--ado-state-resolved); background: rgba(51, 153, 51, 0.12); }
      .work-item-state.state-done { color: var(--ado-state-done); background: rgba(51, 153, 51, 0.12); }
      .work-item-state.state-closed { color: var(--ado-state-closed); background: rgba(51, 153, 51, 0.12); }
      .work-item-state.state-removed { color: var(--ado-state-removed); background: rgba(255, 99, 71, 0.14); }

      .work-item-assignee,
      .work-item-iteration {
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: 11px;
        color: var(--vscode-descriptionForeground);
      }

      .assignee-icon,
      .iteration-icon {
        font-size: 10px;
      }

      .work-item-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 3px;
        margin-top: 3px;
      }

      .work-item-tag {
        padding: 1px 4px;
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid var(--vscode-editorWidget-border);
        border-radius: 8px;
        font-size: 9px;
        color: var(--vscode-editor-foreground);
      }
      .work-item-card.selected .work-item-tag,
      .kanban-card.selected .work-item-tag {
        background: rgba(255, 255, 255, 0.18);
        border-color: rgba(255, 255, 255, 0.25);
        color: var(--vscode-list-activeSelectionForeground);
      }

      .tag-overflow {
        font-size: 9px;
        color: var(--vscode-descriptionForeground);
        padding: 1px 4px;
      }

      .work-item-actions {
        display: flex;
        gap: 4px;
        align-items: center;
        opacity: 0;
        transition: opacity 0.2s ease;
      }

      .work-item-card:hover .work-item-actions {
        opacity: 1;
      }

      .action-btn {
        padding: 4px 6px;
        background: var(--vscode-button-secondaryBackground);
        border: 1px solid var(--vscode-editorWidget-border);
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        transition: all 0.1s ease;
        color: var(--vscode-button-secondaryForeground);
      }

      .action-btn:hover {
        background: var(--vscode-button-secondaryHoverBackground);
        border-color: var(--vscode-focusBorder);
      }

      /* Timer indicator styles */
      .timer-indicator {
        background: rgba(255, 165, 0, 0.2);
        color: #ffa500;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 10px;
        font-weight: 600;
        border: 1px solid rgba(255, 165, 0, 0.3);
        white-space: nowrap;
      }
      .work-item-card.selected .timer-indicator,
      .kanban-card.selected .timer-indicator {
        /* Ensure readable on selection */
        color: var(--vscode-list-activeSelectionForeground);
        border-color: rgba(255, 255, 255, 0.35);
      }

      /* Avoid clashing with colored state stripe; use subtle inset ring for active timer */
      .has-active-timer {
        box-shadow: inset 0 0 0 2px rgba(255, 165, 0, 0.25);
      }

      .has-active-timer .timer-indicator {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
        100% {
          opacity: 1;
        }
      }

      /* Comment button specific style */
      .comment-btn {
        background: var(--vscode-button-secondaryBackground);
        color: #4caf50;
      }

      .comment-btn:hover {
        background: rgba(76, 175, 80, 0.1);
        border-color: #4caf50;
      }

      /* Priority styles */
      .priority-1 {
        color: #ff4444;
      }
      .priority-2 {
        color: #ffb84d;
      }
      .priority-3 {
        color: #4caf50;
      }
      .priority-4 {
        color: #2196f3;
      }

      /* View toggle styles */
      .view-toggle {
        display: flex;
        gap: 4px;
        margin-left: auto;
      }

      .view-toggle-btn {
        padding: 4px 8px;
        background: var(--vscode-button-secondaryBackground);
        border: 1px solid var(--vscode-editorWidget-border);
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        color: var(--vscode-button-secondaryForeground);
        transition: all 0.1s ease;
      }

      .view-toggle-btn:hover {
        background: var(--vscode-button-secondaryHoverBackground);
      }

      .view-toggle-btn.active {
        background: var(--vscode-button-background);
        color: var(--vscode-button-foreground);
        border-color: var(--vscode-focusBorder);
      }

      .timer-section {
        padding: 1rem;
        border: 1px solid var(--vscode-editorWidget-border);
        border-radius: 3px;
        background: rgba(255, 255, 255, 0.02);
      }

      .timer-display {
        font-size: 1.5em;
        font-weight: 600;
        text-align: center;
        margin-bottom: 1rem;
        font-family: 'Consolas', 'Courier New', monospace;
      }

      .timer-controls {
        display: flex;
        gap: 0.5rem;
        justify-content: center;
      }

      .timer-info {
        text-align: center;
        margin-top: 0.5rem;
        font-size: 0.9em;
        opacity: 0.8;
      }

      .status-message {
        text-align: center;
        padding: 2rem;
        opacity: 0.7;
        font-style: italic;
      }

      .loading {
        text-align: center;
        padding: 2rem;
      }

      .error {
        background: rgba(255, 0, 0, 0.1);
        border: 1px solid rgba(255, 0, 0, 0.3);
        color: #ff6b6b;
        padding: 1rem;
        border-radius: 3px;
        margin: 1rem;
      }

      /* Kanban View Styles */
      .kanban-board {
        display: flex;
        gap: 16px;
        padding: 8px;
        overflow-x: auto;
        min-height: calc(100vh - 140px);
      }

      .kanban-column {
        min-width: 280px;
        max-width: 320px;
        background: var(--vscode-editorWidget-background);
        border: 1px solid var(--vscode-editorWidget-border);
        border-radius: 6px;
        display: flex;
        flex-direction: column;
      }

      .kanban-column-header {
        padding: 12px 16px;
        border-bottom: 1px solid var(--vscode-editorWidget-border);
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: var(--vscode-editorGroupHeader-tabsBackground);
      }

      .kanban-column-header h3 {
        margin: 0;
        font-size: 14px;
        font-weight: 600;
        color: var(--vscode-editor-foreground);
      }

      .item-count {
        background: var(--vscode-badge-background);
        color: var(--vscode-badge-foreground);
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
      }

      .kanban-column-content {
        padding: 8px;
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 8px;
        overflow-y: auto;
      }

      .kanban-card {
        background: var(--vscode-editor-background);
        border: 1px solid var(--vscode-editorWidget-border);
        border-radius: 6px;
        padding: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
      }

      .kanban-card:hover {
        background: var(--vscode-list-hoverBackground);
        border-color: var(--vscode-focusBorder);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .kanban-card.selected {
        border-color: var(--vscode-focusBorder);
        background: var(--vscode-list-activeSelectionBackground);
      }

      .kanban-card-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
      }

      .kanban-card-content {
        margin-bottom: 8px;
      }
      /* Ensure kanban titles default to theme foreground */
      .kanban-card .work-item-title {
        color: var(--vscode-editor-foreground);
      }
      /* In selected kanban cards, anchors should inherit selection foreground */
      .kanban-card.selected a,
      .kanban-card.selected:hover a,
      .work-item-card.selected a,
      .work-item-card.selected:hover a {
        color: var(--vscode-list-activeSelectionForeground) !important;
      }

      .kanban-card-meta {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 6px;
        font-size: 11px;
      }

      .kanban-card-actions {
        display: flex;
        gap: 4px;
        opacity: 0;
        transition: opacity 0.2s ease;
      }

      .kanban-card:hover .kanban-card-actions {
        opacity: 1;
      }

      /* State-specific column header colors */
      .kanban-column-header.state-new {
        border-left: 4px solid #6495ed;
      }
      .kanban-column-header.state-active { border-left-color: var(--ado-state-active); }
      .kanban-column-header.state-inprogress { border-left-color: var(--ado-state-inprogress); }
      .kanban-column-header.state-doing { border-left-color: var(--ado-state-doing); }
      .kanban-column-header.state-resolved {
        border-left: 4px solid var(--ado-state-resolved);
      }
      .kanban-column-header.state-done { border-left: 4px solid var(--ado-state-done); }
      .kanban-column-header.state-closed {
        border-left: 4px solid var(--ado-state-closed);
      }
      .kanban-column-header.state-removed {
        border-left: 4px solid #ff6347;
      }
    </style>
    <script type="module" crossorigin src="./main.js"></script>
    <script>
      // Fixture bootstrap for headless screenshot generation:
      // If scripts/screenshots/generate-screenshots.mjs injected window.__AZDO_FIXTURE__,
      // synthesize extension → webview messages so the UI renders without VS Code.
      (function () {
        function bootWithFixtureOnce() {
          try {
            if (window.__AZDO_FIXTURE_BOOTED__) return;
            var f = window.__AZDO_FIXTURE__;
            if (!f) return;
            window.__AZDO_FIXTURE_BOOTED__ = true;

            // 1) Feed work items (and timer) first
            setTimeout(function () {
              try {
                window.postMessage(
                  { type: 'workItemsLoaded', workItems: Array.isArray(f.workItems) ? f.workItems : [] },
                  '*'
                );
                if (f.timer) {
                  window.postMessage({ type: 'timerUpdate', timer: f.timer }, '*');
                  // Ensure timer sidebar is visible in screenshot mode
                  try {
                    var col = document.getElementById('timerColumn');
                    if (col) {
                      col.style.display = '';
                      col.classList.add('timer-visible');
                      col.classList.remove('timer-hidden');
                    }
                    // Expand Compose Summary section to show stop/apply flow
                    var btn = document.getElementById('toggleSummaryBtn');
                    var sc = document.getElementById('summaryContainer');
                    if (btn && sc) {
                      sc.removeAttribute('hidden');
                      btn.setAttribute('aria-expanded', 'true');
                      btn.textContent = 'Compose Summary ▴';
                    }
                  } catch {}
                }
              } catch {}
            }, 0);

            // 2) If kanban requested, toggle once after initial render kicks in
            if (f.view === 'kanban') {
              setTimeout(function () {
                try { window.postMessage({ type: 'toggleKanbanView' }, '*'); } catch {}
              }, 80);
            }

            // 3) Optionally select a specific work item after UI settles
            if (f.selectWorkItemId) {
              setTimeout(function () {
                var sel = document.querySelector(
                  '[data-action="selectWorkItem"][data-id="' + String(f.selectWorkItemId) + '"]'
                );
                if (sel) sel.click();
              }, 160);
            }
          } catch (err) {
            console.error('[webview] Fixture bootstrap failed', err);
          }
        }

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', function () {
            setTimeout(bootWithFixtureOnce, 0);
          });
        } else {
          setTimeout(bootWithFixtureOnce, 0);
        }
      })();
    </script>
  </head>
  <body>
    <div class="search-container">
      <input type="text" id="searchInput" placeholder="Search work items..." class="search-input" />
    </div>

    <div class="status-overview" id="statusOverview">
      <!-- Status badges will be populated by JavaScript -->
    </div>

    <div class="filters-container">
      <select id="sprintFilter" class="filter-dropdown">
        <option value="">All Sprints</option>
      </select>
      <select id="typeFilter" class="filter-dropdown">
        <option value="">All Types</option>
      </select>
      <select id="assignedToFilter" class="filter-dropdown">
        <option value="">All Assignees</option>
      </select>
    </div>

    <div class="main">
      <div class="column" id="workItemsColumn">
        <div class="section">
          <div id="workItemsContainer" class="work-items">
            <div class="loading">Loading work items...</div>
          </div>
        </div>
      </div>

      <div class="column narrow" id="timerColumn" style="display: none">
        <div class="section">
          <h4 class="section-title">Timer</h4>
          <div class="timer-section" id="timerContainer">
            <div id="timerDisplay" class="timer-display">00:00:00</div>
            <div class="timer-controls">
              <button class="btn" id="startTimerBtn" data-action="startTimer" disabled>
                Start
              </button>
              <button class="btn" id="pauseTimerBtn" data-action="pauseTimer" disabled>
                Pause
              </button>
              <button class="btn" id="stopTimerBtn" data-action="stopTimer" disabled>Stop</button>
            </div>
            <div id="timerInfo" class="timer-info">No active timer</div>

            <!-- Collapsible draft comment editor -->
            <div class="summary-section" style="margin-top: 0.75rem">
              <button
                class="btn"
                id="toggleSummaryBtn"
                data-action="toggleSummary"
                aria-expanded="false"
                style="width: 100%; text-align: left"
              >
                Compose Comment ▾
              </button>
              <div id="summaryContainer" class="summary-container" hidden>
                <textarea
                  id="draftSummary"
                  placeholder="Write or generate a comment to post when stopping the timer or adding a comment..."
                  rows="6"
                  style="
                    width: 100%;
                    margin-top: 0.5rem;
                    padding: 0.5rem;
                    font-family: var(--vscode-font-family);
                    font-size: 0.9rem;
                    border-radius: 4px;
                    border: 1px solid var(--vscode-editorWidget-border);
                    background: var(--vscode-input-background);
                    color: var(--vscode-input-foreground);
                  "
                ></textarea>
                <div class="summary-actions" style="display: flex; gap: 0.5rem; margin-top: 0.5rem">
                  <button class="btn" id="generatePromptBtn" data-action="generateCopilotPrompt">
                    Generate Copilot Prompt
                  </button>
                  <button class="btn" id="submitComposeBtn" data-action="submitCompose">
                    Submit Comment
                  </button>
                </div>
                <div
                  id="summaryStatus"
                  class="summary-status"
                  style="
                    margin-top: 0.5rem;
                    font-size: 0.85rem;
                    color: var(--vscode-descriptionForeground);
                  "
                ></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </body>
</html>
