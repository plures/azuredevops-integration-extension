import { TerminalNodeProps } from './schema.js';

/**
 * PraxisDB Adapter
 *
 * Provides a minimal adapter layer for PluresDB integration.
 * This module defines the core interface and an in-memory implementation.
 */
/**
 * Function to unsubscribe from a watch
 */
type UnsubscribeFn = () => void;
/**
 * Core database interface for Praxis
 *
 * Provides a minimal API for get/set/watch operations.
 * Can be backed by in-memory storage or PluresDB.
 */
interface PraxisDB {
    /**
     * Get a value by key
     * @param key The key to retrieve
     * @returns The value or undefined if not found
     */
    get<T>(key: string): Promise<T | undefined>;
    /**
     * Set a value by key
     * @param key The key to set
     * @param value The value to store
     */
    set<T>(key: string, value: T): Promise<void>;
    /**
     * Watch a key for changes
     * @param key The key to watch
     * @param callback Called when the value changes
     * @returns Function to unsubscribe from updates
     */
    watch<T>(key: string, callback: (val: T) => void): UnsubscribeFn;
}
/**
 * In-memory implementation of PraxisDB
 *
 * Provides a simple in-memory store for development and testing.
 * Suitable for proxying to PluresDB later.
 */
declare class InMemoryPraxisDB implements PraxisDB {
    private store;
    private watchers;
    get<T>(key: string): Promise<T | undefined>;
    set<T>(key: string, value: T): Promise<void>;
    watch<T>(key: string, callback: (val: T) => void): UnsubscribeFn;
    /**
     * Get all keys (for testing/debugging)
     */
    keys(): string[];
    /**
     * Clear all data (for testing)
     */
    clear(): void;
}
/**
 * Create a new in-memory PraxisDB instance
 *
 * @returns InMemoryPraxisDB instance
 *
 * @example
 * ```typescript
 * const db = createInMemoryDB();
 * await db.set('user:1', { name: 'Alice' });
 * const user = await db.get('user:1');
 * ```
 */
declare function createInMemoryDB(): InMemoryPraxisDB;
/**
 * PluresDB instance type - represents either PluresNode or SQLiteCompatibleAPI
 */
type PluresDBInstance = {
    get(key: string): Promise<any>;
    put(key: string, value: any): Promise<void>;
};
/**
 * Configuration options for PluresDBPraxisAdapter
 */
interface PluresDBAdapterConfig {
    /** PluresDB instance */
    db: PluresDBInstance;
    /** Polling interval in milliseconds for watch functionality (default: 1000ms) */
    pollInterval?: number;
}
/**
 * PluresDB-backed implementation of PraxisDB
 *
 * Wraps the official PluresDB package from NPM to provide
 * the PraxisDB interface for production use.
 */
declare class PluresDBPraxisAdapter implements PraxisDB {
    private db;
    private watchers;
    private pollIntervals;
    private lastValues;
    private pollInterval;
    constructor(config: PluresDBAdapterConfig | PluresDBInstance);
    get<T>(key: string): Promise<T | undefined>;
    set<T>(key: string, value: T): Promise<void>;
    watch<T>(key: string, callback: (val: T) => void): UnsubscribeFn;
    /**
     * Clean up all resources
     */
    dispose(): void;
}
/**
 * Create a PluresDB-backed PraxisDB instance
 *
 * Wraps the official PluresDB package from NPM.
 *
 * @param config PluresDB instance or configuration object
 * @returns PluresDBPraxisAdapter instance
 *
 * @example
 * ```typescript
 * import { PluresNode } from 'pluresdb';
 * import { createPluresDB } from '@plures/praxis';
 *
 * const pluresdb = new PluresNode({ autoStart: true });
 * const db = createPluresDB(pluresdb);
 *
 * await db.set('user:1', { name: 'Alice' });
 * const user = await db.get('user:1');
 * ```
 *
 * @example
 * ```typescript
 * // With custom polling interval
 * const db = createPluresDB({
 *   db: pluresdb,
 *   pollInterval: 500, // Poll every 500ms
 * });
 * ```
 */
declare function createPluresDB(config: PluresDBAdapterConfig | PluresDBInstance): PluresDBPraxisAdapter;

/**
 * Terminal Node Runtime Adapter
 *
 * Handles terminal command execution and state management.
 * Integrates with pluresDB for state synchronization.
 */

/**
 * Terminal command execution result
 */
interface TerminalExecutionResult {
    /** Command that was executed */
    command: string;
    /** Output from the command */
    output: string;
    /** Exit code (0 for success) */
    exitCode: number;
    /** Execution timestamp */
    timestamp: number;
    /** Error message if execution failed */
    error?: string;
}
/**
 * Terminal node state
 */
interface TerminalNodeState extends TerminalNodeProps {
    /** Node identifier */
    nodeId: string;
    /** Current working directory */
    cwd?: string;
    /** Environment variables */
    env?: Record<string, string>;
}
/**
 * Terminal adapter options
 */
interface TerminalAdapterOptions {
    /** Node identifier */
    nodeId: string;
    /** Initial props */
    props?: Partial<TerminalNodeProps>;
    /** PluresDB path for input binding */
    inputPath?: string;
    /** PluresDB path for output binding */
    outputPath?: string;
    /** Current working directory */
    cwd?: string;
    /** Environment variables */
    env?: Record<string, string>;
    /** PluresDB instance for state persistence */
    db?: PraxisDB;
    /** Command executor function (for custom execution environments) */
    executor?: CommandExecutor;
}
/**
 * Command executor function type
 */
type CommandExecutor = (command: string, options: {
    cwd?: string;
    env?: Record<string, string>;
}) => Promise<{
    output: string;
    exitCode: number;
    error?: string;
}>;
/**
 * Terminal Runtime Adapter
 *
 * Manages terminal node execution and state.
 * Supports command execution with history tracking and PluresDB integration.
 */
declare class TerminalAdapter {
    private state;
    private inputPath?;
    private outputPath?;
    private db?;
    private executor;
    constructor(options: TerminalAdapterOptions);
    /**
     * Execute a terminal command
     *
     * @param command - Command to execute
     * @returns Execution result
     */
    executeCommand(command: string): Promise<TerminalExecutionResult>;
    /**
     * Get current terminal state
     */
    getState(): Readonly<TerminalNodeState>;
    /**
     * Update terminal props
     */
    updateProps(props: Partial<TerminalNodeProps>): void;
    /**
     * Set working directory
     */
    setCwd(cwd: string): void;
    /**
     * Set environment variables
     */
    setEnv(env: Record<string, string>): void;
    /**
     * Clear command history
     */
    clearHistory(): void;
    /**
     * Get command history
     */
    getHistory(): ReadonlyArray<string>;
    /**
     * Sync state to PluresDB
     *
     * @param path - PluresDB path for storing results
     * @param data - Data to sync
     */
    private syncToPluresDB;
    /**
     * Load state from PluresDB
     */
    loadFromPluresDB(): Promise<void>;
    /**
     * Subscribe to input changes from PluresDB
     */
    watchInput(callback: (command: string) => void): (() => void) | null;
}
/**
 * Create a terminal adapter instance
 *
 * @param options - Terminal adapter options
 * @returns Terminal adapter instance
 */
declare function createTerminalAdapter(options: TerminalAdapterOptions): TerminalAdapter;
/**
 * Run a terminal command (convenience function)
 *
 * @param nodeId - Terminal node identifier
 * @param command - Command to execute
 * @param options - Additional options
 * @returns Execution result
 */
declare function runTerminalCommand(nodeId: string, command: string, options?: {
    cwd?: string;
    env?: Record<string, string>;
    db?: PraxisDB;
    executor?: CommandExecutor;
}): Promise<TerminalExecutionResult>;
/**
 * Create a mock executor for testing
 * Returns a function that returns predefined outputs
 */
declare function createMockExecutor(responses: Record<string, {
    output: string;
    exitCode: number;
    error?: string;
}>): CommandExecutor;

export { type CommandExecutor as C, InMemoryPraxisDB as I, type PraxisDB as P, TerminalAdapter as T, type UnsubscribeFn as U, type TerminalExecutionResult as a, type TerminalNodeState as b, createTerminalAdapter as c, type TerminalAdapterOptions as d, createMockExecutor as e, type PluresDBInstance as f, type PluresDBAdapterConfig as g, createInMemoryDB as h, PluresDBPraxisAdapter as i, createPluresDB as j, runTerminalCommand as r };
